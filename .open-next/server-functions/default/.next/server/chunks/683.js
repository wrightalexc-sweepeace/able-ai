exports.id=683,exports.ids=[683],exports.modules={4662:(e,t,i)=>{"use strict";i.d(t,{T:()=>r});let r=["offer","payment","gigUpdate","badge","referral","actionRequired","system"]},9079:(e,t,i)=>{"use strict";i.d(t,{default:()=>u});var r=i(60687),a=i(43210),s=i(88906);let o=()=>{let[e,t]=(0,a.useState)("default");return(0,a.useEffect)(()=>{if(!("Notification"in window)){alert("This browser does not support desktop notification"),t("denied");return}let e=()=>t(Notification.permission);"granted"===Notification.permission?t("granted"):"denied"!==Notification.permission?Notification.requestPermission().then(e=>{t(e)}):t(Notification.permission),"permissions"in navigator&&navigator.permissions.query&&navigator.permissions.query({name:"notifications"}).then(t=>{t.onchange=e})},[]),e};var n=i(36864),l=i(21295);let c=()=>{let e=o(),[t,i]=(0,a.useState)(null),{messaging:r}=(0,n.D)(),{user:s}=(0,l.A)();return(0,a.useEffect)(()=>{},[r,e]),t};var d=i(52581);let u=({children:e})=>{let t=c(),{messaging:i}=(0,n.D)();return(0,a.useEffect)(()=>{if("serviceWorker"in navigator&&i){let e=(0,s.xD)(i,e=>{d.oR.info(e.notification?.title,{icon:e.notification?.icon,description:e.notification?.body})});return()=>e()}},[t,i]),(0,r.jsx)(r.Fragment,{children:e})}},14066:(e,t,i)=>{"use strict";i.a(e,async(e,r)=>{try{i.d(t,{Ay:()=>d,NL:()=>c,S4:()=>u});var a=i(46675),s=i.n(a),o=i(14276),n=e([o]);o=(n.then?(await n)():n)[0];let l=process.env.FIREBASE_ADMIN_SERVICE_ACCOUNT_KEY_JSON;if(!s().apps.length){let e;e=l?JSON.parse(l):{type:process.env.FIREBASE_TYPE,project_id:process.env.FIREBASE_PROJECT_ID,private_key_id:process.env.FIREBASE_PRIVATE_KEY_ID,private_key:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n"),client_email:process.env.FIREBASE_CLIENT_EMAIL,client_id:process.env.FIREBASE_CLIENT_ID,auth_uri:process.env.FIREBASE_AUTH_URI,token_uri:process.env.FIREBASE_TOKEN_URI,auth_provider_x509_cert_url:process.env.FIREBASE_AUTH_PROVIDER_X509_CERT_URL,client_x509_cert_url:process.env.FIREBASE_CLIENT_X509_CERT_URL,universe_domain:process.env.FIREBASE_UNIVERSE_DOMAIN},s().initializeApp({credential:s().credential.cert(e)})}let c=s().firestore(),d=s(),u=(0,o.getAuth)(s().app());r()}catch(e){r(e)}})},14866:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var r=i(37413),a=i(67360),s=i(59363);function o({children:e}){return(0,r.jsx)("div",{children:(0,r.jsx)(s.ProtectedRoute,{children:(0,r.jsx)(a.default,{children:e})})})}},19679:(e,t,i)=>{"use strict";i.d(t,{O:()=>r});let r={BAD_REQUEST:{code:400,message:"Bad Request"},UNAUTHORIZED:{code:401,message:"Unauthorized: You must be logged in to access this resource."},FORBIDDEN:{code:403,message:"Forbidden: You do not have permission to perform this action."},NOT_FOUND:{code:404,message:"Not Found"}}},29034:(e,t,i)=>{"use strict";i.a(e,async(e,r)=>{try{i.d(t,{OH:()=>h,Rz:()=>m,a6:()=>p,gL:()=>R,qM:()=>b,r2:()=>E});var a=i(91199);i(42087);var s=i(14066),o=i(92602),n=i(7879),l=i(47695),c=i(19679),d=i(4662),u=i(33331),f=e([s,o,n,l]);[s,o,n,l]=f.then?(await f)():f;let R=async(e,t)=>{try{let{uid:i}=await (0,l.xA)(e);if(!i)throw c.O.UNAUTHORIZED;if(!t)throw"FCM is required";let r=(0,o.getMessaging)();return await r.subscribeToTopic(t,"general"),await r.subscribeToTopic(t,i),{success:!0,data:"suscribed successfully"}}catch(e){return console.log("Error subscribing to topic",e),{success:!1,error:e}}};async function p(e,t){try{let{userUid:i,title:r,body:a,image:o,path:u,status:f,type:p="system"}=e;if(!d.T.includes(p))return{success:!1,error:`Invalid notification type: ${p}`,data:null};let{data:b}=await (0,l.xA)(t);if(!b)throw c.O.UNAUTHORIZED;let h=e.topic||i;if(!h)return{success:!1,error:"No topic or uid provided",data:null};let m={topic:h,type:p,status:f??"unread",title:r,body:a,image:o,path:u??"/select-role",createTime:n.FieldValue.serverTimestamp()},E=await s.NL.collection("notifications").add(m),R={notification:{title:r,body:a},android:{priority:"high"},webpush:{headers:{Urgency:"high"},notification:{click_action:u||"/"}},data:{notificationId:E.id,type:p},topic:h},g=await s.Ay.messaging().send(R);return{success:!0,data:g}}catch(e){return{success:!1,error:e,data:null}}}async function b(e){let{data:t,uid:i}=await (0,l.xA)(e);if(!t)throw c.O.UNAUTHORIZED;let r=await s.NL.collection("notifications").where("topic","==","general").get(),a=[...(await s.NL.collection("notifications").where("topic","==",i).get()).docs,...r.docs].map(e=>{let t=e.data();return{id:e.id,status:t.status,createTime:t.createTime?.toDate().toISOString()??null,body:t.body,image:t.image,title:t.title,type:t.type,topic:t.topic,path:t.path}}),o=a.filter(e=>"unread"===e.status).length;return{notifications:a,unreadCount:o}}async function h(e){let t=await s.NL.collection("notifications").doc(e).get();return t.exists?{id:t.id,...t.data()}:null}async function m(e){await s.NL.collection("notifications").doc(e).delete()}async function E(e,t){await s.NL.collection("notifications").doc(e).update({status:t})}(0,u.D)([R,p,b,h,m,E]),(0,a.A)(R,"7fad076ff87a53fb2dc1878d8dc87b650c1a1b2caa",null),(0,a.A)(p,"60976633aa90a3960f31dd64f4fd8496ccbdb52456",null),(0,a.A)(b,"400cd1fa767ef5281508e93e3ca1d7a0d11ad8371f",null),(0,a.A)(h,"404660310a5e0f58f816c762a9f12b9b33702d2493",null),(0,a.A)(m,"40bcfd414a2446406921fe5bddeb7f04b82b554661",null),(0,a.A)(E,"60e7f34a33097c37a8e1219f48e58834e6fa037656",null),r()}catch(e){r(e)}})},32449:e=>{e.exports={container:"loading_container__RVnup",pulse:"loading_pulse__m_QbV"}},47695:(e,t,i)=>{"use strict";i.a(e,async(e,r)=>{try{i.d(t,{jk:()=>c,xA:()=>d});var a=i(30298),s=i(60444),o=i(18839),n=i(14066),l=e([a,n]);async function c(e){let{firebaseUid:t,email:i,displayName:r,initialRoleContext:n,phone:l}=e;try{let e=await a.db.query.UsersTable.findFirst({where:(0,o.eq)(s.UsersTable.firebaseUid,t),with:{notificationPreferences:!0}});if(e){let i={updatedAt:new Date};return r&&e.fullName!==r&&(i.fullName=r),l&&e.phone!==l&&(i.phone=l),"BUYER"===n&&!e.isBuyer&&(i.isBuyer=!0,e.lastRoleUsed||(i.lastRoleUsed="BUYER"),await a.db.query.BuyerProfilesTable.findFirst({where:(0,o.eq)(s.BuyerProfilesTable.userId,e.id)})||await a.db.insert(s.BuyerProfilesTable).values({userId:e.id,fullCompanyName:`${r}'s Company`})),"GIG_WORKER"===n&&!e.isGigWorker&&(i.isGigWorker=!0,e.lastRoleUsed||(i.lastRoleUsed="GIG_WORKER"),await a.db.query.GigWorkerProfilesTable.findFirst({where:(0,o.eq)(s.GigWorkerProfilesTable.userId,e.id)})||await a.db.insert(s.GigWorkerProfilesTable).values({userId:e.id})),e.notificationPreferences||await a.db.insert(s.NotificationPreferencesTable).values({userId:e.id}),Object.keys(i).length>1&&(await a.db.update(s.UsersTable).set(i).where((0,o.eq)(s.UsersTable.firebaseUid,t)).returning(),e=await a.db.query.UsersTable.findFirst({where:(0,o.eq)(s.UsersTable.firebaseUid,t),with:{notificationPreferences:!0}})||e),e}{let e="BUYER"===n,c="GIG_WORKER"===n,d=(await a.db.insert(s.UsersTable).values({firebaseUid:t,email:i,fullName:r,appRole:"USER",isBuyer:e,isGigWorker:c,lastRoleUsed:n||null,phone:l}).returning())[0];if(!d)return null;return await a.db.insert(s.NotificationPreferencesTable).values({userId:d.id}),e&&await a.db.insert(s.BuyerProfilesTable).values({userId:d.id,fullCompanyName:`${r}'s Company`}),c&&await a.db.insert(s.GigWorkerProfilesTable).values({userId:d.id}),await a.db.query.UsersTable.findFirst({where:(0,o.eq)(s.UsersTable.id,d.id),with:{notificationPreferences:!0}})??null}}catch(e){return console.error("Error in findOrCreatePgUserAndUpdateRole:",e),null}}async function d(e){try{if(!e)throw Error("Id token is required");let t=await n.Ay.auth().verifyIdToken(e);return{data:!0,uid:t.uid}}catch(e){throw console.error("Invalid or expired token:",e),"Invalid or expired token"}}[a,n]=l.then?(await l)():l,r()}catch(e){r(e)}})},59363:(e,t,i)=>{"use strict";i.d(t,{ProtectedRoute:()=>r});let r=(0,i(12907).registerClientReference)(function(){throw Error("Attempted to call ProtectedRoute() from the server but ProtectedRoute is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/israel/personal/code/alex/able-ai/utils/ProtectedRoute.tsx","ProtectedRoute")},62201:(e,t,i)=>{"use strict";i.d(t,{ProtectedRoute:()=>d});var r=i(60687),a=i(30474),s=i(21295),o=i(16189),n=i(43210),l=i(32449),c=i.n(l);let d=({children:e})=>{let{user:t,loading:i}=(0,s.A)(),l=(0,o.useRouter)();return((0,n.useEffect)(()=>{i||t?.claims.role||l.push("/signin")},[i,t?.claims]),i||!t)?(0,r.jsx)("div",{className:c().container,children:(0,r.jsx)(a.default,{src:"/images/ableai.png",alt:"Loading Logo",width:180,height:180,className:c().pulse,priority:!0})}):(0,r.jsx)(r.Fragment,{children:e})}},67360:(e,t,i)=>{"use strict";i.d(t,{default:()=>r});let r=(0,i(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/israel/personal/code/alex/able-ai/lib/firebase/fcm/FcmProvider.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/israel/personal/code/alex/able-ai/lib/firebase/fcm/FcmProvider.tsx","default")},72708:(e,t,i)=>{Promise.resolve().then(i.bind(i,67360)),Promise.resolve().then(i.bind(i,59363))},86212:(e,t,i)=>{Promise.resolve().then(i.bind(i,9079)),Promise.resolve().then(i.bind(i,62201))}};