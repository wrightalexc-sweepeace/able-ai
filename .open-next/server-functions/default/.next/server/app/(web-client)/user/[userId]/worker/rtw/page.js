(()=>{var e={};e.id=9030,e.ids=[9030],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6475:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),!function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{callServer:function(){return a.callServer},createServerReference:function(){return s},findSourceMapURL:function(){return n.findSourceMapURL}});let a=t(11264),n=t(11448),s=t(19357).createServerReference},7879:e=>{"use strict";e.exports=import("firebase-admin/firestore")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14276:e=>{"use strict";e.exports=import("firebase-admin/auth")},14985:e=>{"use strict";e.exports=require("dns")},15206:(e,r,t)=>{"use strict";t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{"400cd1fa767ef5281508e93e3ca1d7a0d11ad8371f":()=>n.qM,"403cc22ea473a4e0e8cd51344cd05b484e1dd43c6d":()=>s.T,"404660310a5e0f58f816c762a9f12b9b33702d2493":()=>n.OH,"40bcfd414a2446406921fe5bddeb7f04b82b554661":()=>n.Rz,"60976633aa90a3960f31dd64f4fd8496ccbdb52456":()=>n.a6,"60e7f34a33097c37a8e1219f48e58834e6fa037656":()=>n.r2,"7fad076ff87a53fb2dc1878d8dc87b650c1a1b2caa":()=>n.gL});var n=t(29034),s=t(78103),i=e([n,s]);[n,s]=i.then?(await i)():i,a()}catch(e){a(e)}})},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},19984:(e,r,t)=>{Promise.resolve().then(t.bind(t,98741))},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30474:(e,r,t)=>{"use strict";t.d(r,{default:()=>n.a});var a=t(31261),n=t.n(a)},30840:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var a=t(65239),n=t(48088),s=t(88170),i=t.n(s),o=t(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(r,l);let d={children:["",{children:["(web-client)",{children:["user",{children:["[userId]",{children:["worker",{children:["rtw",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,98741)),"/home/israel/personal/code/alex/able-ai/app/(web-client)/user/[userId]/worker/rtw/page.tsx"]}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,14866)),"/home/israel/personal/code/alex/able-ai/app/(web-client)/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,58014)),"/home/israel/personal/code/alex/able-ai/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/home/israel/personal/code/alex/able-ai/app/(web-client)/user/[userId]/worker/rtw/page.tsx"],u={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:n.RouteKind.APP_PAGE,page:"/(web-client)/user/[userId]/worker/rtw/page",pathname:"/user/[userId]/worker/rtw",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},31261:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),!function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{default:function(){return l},getImageProps:function(){return o}});let a=t(37366),n=t(44953),s=t(46533),i=a._(t(1933));function o(e){let{props:r}=(0,n.getImgProps)(e,{defaultLoader:i.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,t]of Object.entries(r))void 0===t&&delete r[e];return{props:r}}let l=s.Image},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},46675:e=>{"use strict";e.exports=require("firebase-admin")},54832:(e,r,t)=>{Promise.resolve().then(t.bind(t,98841))},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{"use strict";e.exports=import("pg")},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},78103:(e,r,t)=>{"use strict";t.a(e,async(e,a)=>{try{t.d(r,{T:()=>c});var n=t(91199);t(42087);var s=t(30298),i=t(60444),o=t(18839),l=t(33331),d=e([s]);s=(d.then?(await d)():d)[0];let u=e=>`${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${e.getFullYear()}`;async function c(e){try{let{userId:r,forename:t,surname:a,shareCode:n}=e,l=function(e){let r=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(r)return new Date(+r[1],r[2]-1,+r[3]);let t=e.match(/^(\d{2})-(\d{2})-(\d{4})$/);if(t)return new Date(+t[3],t[2]-1,+t[1]);throw Error("Invalid DOB format")}(e.dob);if(!await s.db.query.UsersTable.findFirst({where:(0,o.eq)(i.UsersTable.firebaseUid,r),columns:{id:!0}}))return{error:"User not found",status:404};let d=new Date;if(d.setFullYear(d.getFullYear()-18),l>d)throw Error("Applicant must be 18 or over");let c="true"===process.env.USE_RTW_MOCK||!process.env.UK_RTW_API_SECRET,p=null;if(c){let e=String(n).trim().toUpperCase(),r="NOT_FOUND";"WACCEPT"===e?r="ACCEPTED":"WEXPIRED"===e?r="EXPIRED":"WLOCKED"===e?r="LOCKED":"WREJECT"===e&&(r="REJECTED"),p={outcome:r,expiry_date:"ACCEPTED"===r?u(new Date(new Date().setMonth(new Date().getMonth()+6))):null,details:"Mock result",govuk_check_details:{check_date:u(new Date),reference_number:`RTW-${Math.random().toString(36).slice(2,10).toUpperCase()}`,company_name:process.env.UK_RTW_COMPANY_NAME||"Able AI Ltd (Mock)"}}}else{let e=process.env.UK_RTW_API_SECRET,r=process.env.UK_RTW_COMPANY_NAME||"Able AI Ltd",s=new URLSearchParams({code:n,dob:u(l),forename:t,surname:a,company_name:r,allow_student:"true",allow_sponsorship:"true"}),i=await fetch(`https://app.ukrtwchecker.co.uk/rtw?${s.toString()}`,{method:"GET",headers:{"X-UKRTWAPI-SECRET":e},cache:"no-store"});if(!i.ok){let e=await i.text();throw Error(`Provider error ${i.status}: ${e.slice(0,300)}`)}let o=await i.json();p=o?.status??o}let h={outcome:String(p?.outcome||"NOT_FOUND").toUpperCase(),name:{forename:t,surname:a},dob:new Date(l).toDateString(),permission_expiry_date:p?.expiry_date??null,govuk_check_details:{check_date:p?.govuk_check_details?.check_date??null,reference_number:p?.govuk_check_details?.reference_number??null,company_name:p?.govuk_check_details?.company_name??null},evidence_available:p?.evidence_available??null,last_checked_at:p?.last_checked_at??null,details:p?.details??null,referenceNumber:p?.govuk_check_details?.reference_number??null,provider_name:p?.govuk_check_details?.company_name??null,name_match:p?.name_match??null,raw:p};return await s.db.update(i.UsersTable).set({updatedAt:new Date,rtwStatus:h.outcome}).where((0,o.eq)(i.UsersTable.firebaseUid,r)),{error:null,payload:h,status:200}}catch(e){return console.error("Error in runRtwCheckAndStore:",e),{error:e instanceof Error?e.message:"Unknown error",status:500}}}(0,l.D)([c]),(0,n.A)(c,"403cc22ea473a4e0e8cd51344cd05b484e1dd43c6d",null),a()}catch(e){a(e)}})},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},92602:e=>{"use strict";e.exports=import("firebase-admin/messaging")},94735:e=>{"use strict";e.exports=require("events")},98741:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});let a=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/israel/personal/code/alex/able-ai/app/(web-client)/user/[userId]/worker/rtw/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/israel/personal/code/alex/able-ai/app/(web-client)/user/[userId]/worker/rtw/page.tsx","default")},98841:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>p});var a=t(60687),n=t(43210);let s={page:{minHeight:"100vh",background:"#000",color:"white"},header:{padding:"32px 24px"},title:{fontSize:28,fontWeight:800,marginBottom:6},main:{padding:"0 24px 40px"},formGrid:{maxWidth:640,margin:"0 auto",display:"grid",gap:16,gridTemplateColumns:"1fr"},colHalf:{gridColumn:"1 / -1"},colFull:{gridColumn:"1 / -1"},fieldRow:{display:"grid",gap:8},label:{color:"#e5e7eb",fontSize:13,fontWeight:600,display:"flex",alignItems:"center",gap:6},required:{color:"#9ca3af",fontSize:12},help:{color:"#9ca3af",fontSize:11,marginTop:6},input:{width:"100%",padding:"12px 16px",borderRadius:18,border:"1px solid #374151",backgroundColor:"#111827",color:"#e5e7eb",fontSize:14,outline:"none",transition:"box-shadow 120ms ease, border-color 120ms ease"},inputFocus:{boxShadow:"0 0 0 2px rgba(96,165,250,0.45)"},banner:{color:"#e5e7eb",lineHeight:1.5,fontSize:16},error:{color:"#fca5a5",fontSize:13},submit:{width:"100%",padding:"14px 16px",background:"#60a5fa",color:"#0b0f1a",borderRadius:12,border:"none",fontWeight:800,cursor:"pointer"},result:{maxWidth:960,margin:"18px auto 0",padding:16,border:"1px solid #1f2937",borderRadius:12,background:"#0b1220",color:"#e5e7eb",fontSize:14},resultHeader:{display:"flex",gap:8,alignItems:"center",marginBottom:8},resultName:{},resultGrid:{display:"grid",gap:6},badge:{color:"white",padding:"2px 8px",borderRadius:999,fontSize:12},resultDetail:{fontSize:"14px",marginTop:"6px",color:"#e5e7eb"}};var i=t(6475);let o=(0,i.createServerReference)("403cc22ea473a4e0e8cd51344cd05b484e1dd43c6d",i.callServer,void 0,i.findSourceMapURL,"runRtwCheckAndStore");var l=t(21295);function d(e){let{id:r,label:t,required:n,helpText:i,children:o}=e;return(0,a.jsxs)("div",{style:s.fieldRow,children:[(0,a.jsxs)("label",{htmlFor:r,style:s.label,children:[t," ",n&&(0,a.jsx)("span",{style:s.required,children:"(Required)"})]}),o,i?(0,a.jsx)("div",{style:s.help,children:i}):null]})}function c(e){let{id:r,type:t="text",placeholder:i,value:o,onChange:l}=e,[d,c]=(0,n.useState)(!1),u=d?{...s.input,...s.inputFocus}:s.input;return(0,a.jsx)("input",{id:r,type:t,placeholder:i,value:o,onChange:e=>l(e.target.value),onFocus:()=>c(!0),onBlur:()=>c(!1),style:{...u,..."date"===t?{colorScheme:"dark"}:null}})}function u({children:e}){return(0,a.jsx)("div",{style:s.banner,children:e})}function p(){let[e,r]=(0,n.useState)({share_code:"",dob:"",forename:"",surname:""}),[t,i]=(0,n.useState)(!1),[p,h]=(0,n.useState)(null),[m,f]=(0,n.useState)(null),{user:b}=(0,l.A)();async function x(r){r.preventDefault(),f(null),h(null);let t=function(e){if(!e)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[r,t,a]=e.split("-").map(Number);return isNaN(new Date(r,t-1,a).getTime())?null:e}if(/^\d{2}-\d{2}-\d{4}$/.test(e)){let[r,t,a]=e.split("-").map(Number);return isNaN(new Date(a,t-1,r).getTime())?null:e}if(/^\d{2}\/\d{2}\/\d{4}$/.test(e)){let[r,t,a]=e.split("/").map(Number);return isNaN(new Date(a,t-1,r).getTime())?null:e}return null}(e.dob);if(!t){alert("Please enter a valid date of birth."),f("Please enter a valid date of birth.");return}if(function(e){let r=new Date,t=new Date(r.getFullYear()-18,r.getMonth(),r.getDate());return new Date(e)>t}(t)){alert("We can only process applications for individuals aged 18 or over."),f("Applicants must be at least 18 years old.");return}if(b?.uid){i(!0);try{let{error:r,payload:a}=await o({userId:b?.uid,forename:e.forename,surname:e.surname,dob:t,shareCode:e.share_code});if(r)throw Error();console.warn(a),h(a)}catch(e){f(e.message||"Something went wrong")}finally{i(!1)}}}return(0,a.jsxs)("div",{style:s.page,children:[(0,a.jsx)("header",{style:s.header,children:(0,a.jsx)("h1",{style:s.title,children:"Validate your Right to Work in the UK"})}),(0,a.jsxs)("main",{style:s.main,children:[(0,a.jsxs)("form",{onSubmit:x,style:s.formGrid,children:[(0,a.jsx)("div",{style:s.colHalf,children:(0,a.jsx)(d,{id:"share_code",label:"Share Code",required:!0,helpText:"This is usually 8–11 characters, a mixture of letters and numbers, starting with ‘W’.",children:(0,a.jsx)(c,{id:"share_code",placeholder:"Enter share code",value:e.share_code,onChange:e=>r(r=>({...r,share_code:e}))})})}),(0,a.jsx)("div",{style:s.colHalf,children:(0,a.jsx)(d,{id:"dob",label:"Date of Birth",required:!0,children:(0,a.jsx)(c,{id:"dob",type:"date",placeholder:"dd-mm-yyyy",value:e.dob,onChange:e=>r(r=>({...r,dob:e}))})})}),(0,a.jsx)("div",{style:s.colHalf,children:(0,a.jsx)(d,{id:"forename",label:"Forename",required:!0,children:(0,a.jsx)(c,{id:"forename",placeholder:"Enter first name(s)",value:e.forename,onChange:e=>r(r=>({...r,forename:e}))})})}),(0,a.jsx)("div",{style:s.colHalf,children:(0,a.jsx)(d,{id:"surname",label:"Surname",required:!0,children:(0,a.jsx)(c,{id:"surname",placeholder:"Enter surname(s)",value:e.surname,onChange:e=>r(r=>({...r,surname:e}))})})}),(0,a.jsx)("div",{style:s.colFull,children:(0,a.jsx)(u,{children:"Sorry, right now because of UK immigration laws, foreign students cannot work as freelancers :("})}),m&&(0,a.jsx)("div",{style:s.colFull,children:(0,a.jsx)("div",{style:s.error,children:m})}),(0,a.jsx)("div",{style:s.colFull,children:(0,a.jsx)("button",{disabled:t,type:"submit",style:s.submit,children:t?"Checking...":"Submit"})})]}),p&&(0,a.jsxs)("section",{style:s.result,children:[(0,a.jsxs)("div",{style:s.resultHeader,children:[(0,a.jsx)(function({outcome:e}){return(0,a.jsx)("span",{style:{...s.badge,background:"ACCEPTED"===e?"#10b981":"EXPIRED"===e||"REJECTED"===e?"#ef4444":"#f59e0b"},children:e})},{outcome:p.outcome}),(0,a.jsxs)("strong",{style:s.resultName,children:[p.name.forename," ",p.name.surname]})]}),(0,a.jsxs)("div",{style:s.resultGrid,children:[(0,a.jsxs)("div",{children:["DOB: ",p.dob]}),(0,a.jsxs)("div",{children:["Permission expiry: ",p.permission_expiry_date??"—"]}),(0,a.jsxs)("div",{children:["Reference: ",p.govuk_check_details.reference_number]}),(0,a.jsxs)("div",{children:["Last checked: ",new Date(p.last_checked_at).toLocaleString()]}),(0,a.jsxs)("div",{children:["Company: ",p.govuk_check_details.company_name]}),p.details&&(0,a.jsxs)("p",{style:s.resultDetail,children:[(0,a.jsx)("strong",{children:"Status:"})," ",p.details]})]})]})]})]})}}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[4447,9558,1658,6533,2002,6637,683],()=>t(30840));module.exports=a})();