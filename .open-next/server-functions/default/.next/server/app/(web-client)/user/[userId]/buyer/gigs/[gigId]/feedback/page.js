(()=>{var e={};e.id=3899,e.ids=[3899],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7879:e=>{"use strict";e.exports=import("firebase-admin/firestore")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12470:(e,t,r)=>{"use strict";r.d(t,{o:()=>i});var s=r(8835);let a=process.env.STRIPE_SECRET_KEY,i=a?new s.A(a):new Proxy({},{get(){throw Error("Stripe is not configured (missing STRIPE_SECRET_KEY). This action requires Stripe to be set up.")}})},14276:e=>{"use strict";e.exports=import("firebase-admin/auth")},14985:e=>{"use strict";e.exports=require("dns")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},34957:(e,t,r)=>{Promise.resolve().then(r.bind(r,94624))},36125:(e,t,r)=>{"use strict";async function s(e){try{return localStorage.setItem("lastRoleUsed",e),null}catch(e){console.log("Error updating last role used:",e)}}function a(){try{return window.localStorage.getItem("lastRoleUsed")}catch(e){return console.log("Error retrieving last role used:",e),null}}r.d(t,{C:()=>s,K:()=>a})},37165:(e,t,r)=>{Promise.resolve().then(r.bind(r,48620))},46675:e=>{"use strict";e.exports=require("firebase-admin")},48620:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/israel/personal/code/alex/able-ai/app/(web-client)/user/[userId]/buyer/gigs/[gigId]/feedback/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/israel/personal/code/alex/able-ai/app/(web-client)/user/[userId]/buyer/gigs/[gigId]/feedback/page.tsx","default")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57145:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{B:()=>m});var a=r(91199);r(42087);var i=r(12470),n=r(30298),o=r(18839),u=r(60444),d=r(33331),l=e([n]);n=(l.then?(await l)():l)[0];let g=i.o,h=async e=>{let t=await g.paymentIntents.retrieve(e,{expand:["latest_charge.balance_transaction"]});if(!t||"requires_capture"!==t.status)throw Error(`Payment Intent ${e} is no in status 'requires_capture' (current: ${t?.status}).`);return t};async function c(e){return await n.db.query.PaymentsTable.findMany({where:(0,o.Uo)((0,o.eq)(u.PaymentsTable.gigId,e),(0,o.eq)(u.PaymentsTable.status,"PENDING")),columns:{id:!0,amountGross:!0,stripePaymentIntentId:!0}})}async function p(e,t){return await n.db.update(u.PaymentsTable).set({paidAt:new Date,status:"COMPLETED",stripeChargeId:t}).where((0,o.eq)(u.PaymentsTable.id,e)).returning()}async function f(e,t){return await n.db.update(u.GigsTable).set({statusInternal:t}).where((0,o.eq)(u.GigsTable.id,e)).returning()}async function b(e,t,r){let s=t;for(let t of e){if(s<=0)return;let e=t.stripePaymentIntentId,a=await h(e),i=Number(t.amountGross),n=Math.min(s,i),o=Math.round(n*(r||.065)),u=await g.paymentIntents.capture(a.id,{amount_to_capture:n,application_fee_amount:o});if("succeeded"!==u.status)throw Error(`Failed to capture PaymentIntent ${e}: ${u.status}`);await p(t.id,u.latest_charge),console.log(`Captured ${n} cents from PaymentIntent ${e}.`),s-=n}}async function m(e){let{gigId:t}=e;try{let e=await n.db.query.GigsTable.findFirst({where:(0,o.eq)(u.GigsTable.id,t)});if(!e)return;let r=Number(e.finalAgreedPrice),s=Number(e.ableFeePercent),a=await c(t);if(0===a.length)throw Error("No payments found for this gig.");await b(a,r,s),await f(t,"PAID"),console.log(`All payments finalized for gig ${t}. Total captured: ${r} cents.`)}catch(e){throw console.error(`Failed to finalize payment for gig ${t}:`,e),e}}(0,d.D)([m]),(0,a.A)(m,"40cc0686f8991cfcb82ef6d697a39002e1df90ae4a",null),s()}catch(e){s(e)}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63427:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{"400cd1fa767ef5281508e93e3ca1d7a0d11ad8371f":()=>a.qM,"404660310a5e0f58f816c762a9f12b9b33702d2493":()=>a.OH,"40bcfd414a2446406921fe5bddeb7f04b82b554661":()=>a.Rz,"40cc0686f8991cfcb82ef6d697a39002e1df90ae4a":()=>i.B,"60976633aa90a3960f31dd64f4fd8496ccbdb52456":()=>a.a6,"60e7f34a33097c37a8e1219f48e58834e6fa037656":()=>a.r2,"7fad076ff87a53fb2dc1878d8dc87b650c1a1b2caa":()=>a.gL});var a=r(29034),i=r(57145),n=e([a,i]);[a,i]=n.then?(await n)():n,s()}catch(e){s(e)}})},64939:e=>{"use strict";e.exports=import("pg")},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},76072:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>c,pages:()=>l,routeModule:()=>p,tree:()=>d});var s=r(65239),a=r(48088),i=r(88170),n=r.n(i),o=r(30893),u={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(u[e]=()=>o[e]);r.d(t,u);let d={children:["",{children:["(web-client)",{children:["user",{children:["[userId]",{children:["buyer",{children:["gigs",{children:["[gigId]",{children:["feedback",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,48620)),"/home/israel/personal/code/alex/able-ai/app/(web-client)/user/[userId]/buyer/gigs/[gigId]/feedback/page.tsx"]}]},{}]},{}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,14866)),"/home/israel/personal/code/alex/able-ai/app/(web-client)/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,58014)),"/home/israel/personal/code/alex/able-ai/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,l=["/home/israel/personal/code/alex/able-ai/app/(web-client)/user/[userId]/buyer/gigs/[gigId]/feedback/page.tsx"],c={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/(web-client)/user/[userId]/buyer/gigs/[gigId]/feedback/page",pathname:"/user/[userId]/buyer/gigs/[gigId]/feedback",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},92602:e=>{"use strict";e.exports=import("firebase-admin/messaging")},94624:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var s=r(60687),a=r(43210),i=r(16189),n=r(41862),o=r(21295),u=r(18591),d=r(36125),l=r(6475);let c=(0,l.createServerReference)("40cc0686f8991cfcb82ef6d697a39002e1df90ae4a",l.callServer,void 0,l.findSourceMapURL,"processGigPayment");function p(){let e=(0,i.useRouter)(),t=(0,i.useParams)();t.userId;let r=t.gigId,l=(0,d.K)(),{user:p,loading:f}=(0,o.A)();p?.uid;let[b,m]=(0,a.useState)(null),[g,h]=(0,a.useState)(!0),[x,y]=(0,a.useState)(!1),[w,v]=(0,a.useState)(null),[P,q]=(0,a.useState)(null),I=async t=>(v(null),q(null),t.wouldHireAgain)?b&&p?.uid?void("BUYER"===l&&await _(),y(!0),setTimeout(()=>{q(`Feedback for ${b.workerName} submitted successfully!`),y(!1),e.push(`/user/${p?.uid||"this_user"}/buyer`)},1500)):void v("Gig information or user ID is missing."):void v("Please select if you would hire this worker again."),_=async()=>{p&&b&&(await c({gigId:r}),q("Work paid successfully!"))};return f||g?(0,s.jsxs)("div",{className:"flex items-center justify-center h-40",children:[(0,s.jsx)(n.A,{className:"animate-spin",size:32})," Loading..."]}):(0,s.jsx)(u.A,{gigData:b,user:p,role:"BUYER",mode:"buyer",onSubmit:I,loading:x,error:w,successMessage:P,handleBack:()=>e.back()})}},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,9558,1658,6533,2002,7715,8065,6637,683,6936],()=>r(76072));module.exports=s})();