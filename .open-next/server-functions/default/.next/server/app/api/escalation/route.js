"use strict";(()=>{var e={};e.id=9881,e.ids=[9881],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13370:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{DELETE:()=>c,GET:()=>i,POST:()=>u});var a=t(32190),o=t(86065),n=e([o]);async function u(e){try{let{action:s,...t}=await e.json();switch(s){case"create":let r=await (0,o.Aq)(t);if(r.success)return a.NextResponse.json({success:!0,issueId:r.issueId,issue:r.issue});return a.NextResponse.json({success:!1,error:r.error},{status:500});case"update":let n=await (0,o.vA)(t);if(n.success)return a.NextResponse.json({success:!0,issue:n.issue});return a.NextResponse.json({success:!1,error:n.error},{status:500});default:return a.NextResponse.json({success:!1,error:"Invalid action"},{status:400})}}catch(e){return console.error("❌ Escalation API error:",e),a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function i(e){try{let{searchParams:s}=new URL(e.url),t=s.get("action"),r=s.get("userId"),n=s.get("status");switch(t){case"user":if(!r)return a.NextResponse.json({success:!1,error:"User ID required"},{status:400});let u=await (0,o.u_)(r);return a.NextResponse.json(u);case"open":let i=await (0,o.Hr)();return a.NextResponse.json(i);case"by-status":if(!n)return a.NextResponse.json({success:!1,error:"Status required"},{status:400});let c=await (0,o.a9)(n);return a.NextResponse.json(c);default:return a.NextResponse.json({success:!1,error:"Invalid action"},{status:400})}}catch(e){return console.error("❌ Escalation API error:",e),a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function c(e){try{let{searchParams:s}=new URL(e.url),t=s.get("id");if(!t)return a.NextResponse.json({success:!1,error:"Issue ID required"},{status:400});let r=await (0,o.HZ)(t);return a.NextResponse.json(r)}catch(e){return console.error("❌ Escalation API error:",e),a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}o=(n.then?(await n)():n)[0],r()}catch(e){r(e)}})},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},53865:(e,s,t)=>{t.d(s,{DW:()=>f});var r=t(59672),a=t(79252),o=t(34509),n=t(29334),u=t(9253),i=t(9594),c=t(37193),d=t(63431),l=t(42270),p=t(75383);(0,r.cJ)("system_flags",{flag_key:(0,a.yf)("flag_key",{length:255}).notNull().unique(),flag_value:(0,o.Fx)("flag_value").notNull(),description:(0,n.Qq)("description"),createdAt:(0,u.vE)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,u.vE)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),(0,r.cJ)("user_ai_usage",{id:(0,i.uR)("id").default((0,l.ll)`gen_random_uuid()`).notNull().primaryKey(),userId:(0,i.uR)("user_id").notNull().references(()=>p.Lh.id,{onDelete:"cascade"}),date:(0,c.p6)("date").notNull(),aiMessageCount:(0,d.nd)("ai_message_count").default(0).notNull(),lastInteractionTimestamp:(0,u.vE)("last_interaction_timestamp",{withTimezone:!0}),createdAt:(0,u.vE)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,u.vE)("updated_at",{withTimezone:!0}).defaultNow().notNull()});let f=(0,r.cJ)("escalated_issues",{id:(0,i.uR)("id").default((0,l.ll)`gen_random_uuid()`).notNull().primaryKey(),userId:(0,i.uR)("user_id").notNull().references(()=>p.Lh.id,{onDelete:"cascade"}),firestoreMessageId:(0,a.yf)("firestore_message_id",{length:255}),gigId:(0,a.yf)("gig_id",{length:255}),issueType:(0,a.yf)("issue_type",{length:100}),description:(0,n.Qq)("description"),status:(0,a.yf)("status",{length:50}).default("OPEN").notNull(),adminUserId:(0,i.uR)("admin_user_id").references(()=>p.Lh.id,{onDelete:"set null"}),resolutionNotes:(0,n.Qq)("resolution_notes"),createdAt:(0,u.vE)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,u.vE)("updated_at",{withTimezone:!0}).defaultNow().notNull()})},58176:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{patchFetch:()=>c,routeModule:()=>d,serverHooks:()=>f,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>p});var a=t(96559),o=t(48088),n=t(37719),u=t(13370),i=e([u]);u=(i.then?(await i)():i)[0];let d=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/escalation/route",pathname:"/api/escalation",filename:"route",bundlePath:"app/api/escalation/route"},resolvedPagePath:"/home/israel/personal/code/alex/able-ai/app/api/escalation/route.ts",nextConfigOutput:"standalone",userland:u}),{workAsyncStorage:l,workUnitAsyncStorage:p,serverHooks:f}=d;function c(){return(0,n.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:p})}r()}catch(e){r(e)}})},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{e.exports=import("pg")},86065:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.d(s,{Aq:()=>c,HZ:()=>g,Hr:()=>p,a9:()=>f,u_:()=>l,vA:()=>d});var a=t(96149),o=t(53865),n=t(75383),u=t(94634),i=e([a]);async function c(e){try{let s=await a.db.query.UsersTable.findFirst({where:(0,u.eq)(n.Lh.firebaseUid,e.userId)});if(!s)return console.error("❌ User not found for Firebase UID:",e.userId),{success:!1,error:"User not found"};let[t]=await a.db.insert(o.DW).values({userId:s.id,firestoreMessageId:e.firestoreMessageId,gigId:e.gigId,issueType:e.issueType,description:e.description,status:"OPEN"}).returning();return console.log("✅ Escalated issue created:",t.id),{success:!0,issueId:t.id,issue:t}}catch(e){return console.error("❌ Failed to create escalated issue:",e),{success:!1,error:"Failed to create escalated issue"}}}async function d(e){try{let s={};e.status&&(s.status=e.status),e.adminUserId&&(s.adminUserId=e.adminUserId),e.resolutionNotes&&(s.resolutionNotes=e.resolutionNotes),s.updatedAt=new Date;let[t]=await a.db.update(o.DW).set(s).where((0,u.eq)(o.DW.id,e.id)).returning();return console.log("✅ Escalated issue updated:",e.id),{success:!0,issue:t}}catch(e){return console.error("❌ Failed to update escalated issue:",e),{success:!1,error:"Failed to update escalated issue"}}}async function l(e){try{let s=await a.db.select().from(o.DW).where((0,u.eq)(o.DW.userId,e)).orderBy(o.DW.createdAt);return{success:!0,issues:s}}catch(e){return console.error("❌ Failed to get user escalated issues:",e),{success:!1,error:"Failed to get escalated issues"}}}async function p(){try{let e=await a.db.select().from(o.DW).where((0,u.eq)(o.DW.status,"OPEN")).orderBy(o.DW.createdAt);return{success:!0,issues:e}}catch(e){return console.error("❌ Failed to get open escalated issues:",e),{success:!1,error:"Failed to get open escalated issues"}}}async function f(e){try{let s=await a.db.select().from(o.DW).where((0,u.eq)(o.DW.status,e)).orderBy(o.DW.createdAt);return{success:!0,issues:s}}catch(e){return console.error("❌ Failed to get escalated issues by status:",e),{success:!1,error:"Failed to get escalated issues"}}}async function g(e){try{return await a.db.delete(o.DW).where((0,u.eq)(o.DW.id,e)),console.log("✅ Escalated issue deleted:",e),{success:!0}}catch(e){return console.error("❌ Failed to delete escalated issue:",e),{success:!1,error:"Failed to delete escalated issue"}}}a=(i.then?(await i)():i)[0],r()}catch(e){r(e)}})}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[4447,580,2946,8161],()=>t(58176));module.exports=r})();