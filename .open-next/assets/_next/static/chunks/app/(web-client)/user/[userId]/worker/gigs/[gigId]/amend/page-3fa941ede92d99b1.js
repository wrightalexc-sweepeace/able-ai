(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1384],{25731:(e,a,n)=>{"use strict";n.d(a,{A:()=>d,O:()=>o});var t=n(95155),s=n(12115),i=n(16203),r=n(85004);let l=(0,s.createContext)({user:null,loading:!0});async function c(e){for(let n=0;n<10;n++){var a;let n=await (0,i.yx)(e,!0);if(null==(a=n.claims)?void 0:a.role)return n;await new Promise(e=>setTimeout(e,1e3))}return null}let o=e=>{let{children:a}=e,[n,o]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0),{authClient:g,loading:m}=(0,r.D)();return(0,s.useEffect)(()=>{let e=()=>{};return!m&&g&&(e=(0,i.hg)(g,async e=>{if(e){let a=await c(e);a?o(Object.assign(e,{token:a.token,claims:a.claims})):o(null)}else o(null);u(!1)})),()=>e()},[m]),(0,t.jsx)(l.Provider,{value:{user:n,loading:d},children:a})},d=()=>(0,s.useContext)(l)},35695:(e,a,n)=>{"use strict";var t=n(18999);n.o(t,"useParams")&&n.d(a,{useParams:function(){return t.useParams}}),n.o(t,"usePathname")&&n.d(a,{usePathname:function(){return t.usePathname}}),n.o(t,"useRouter")&&n.d(a,{useRouter:function(){return t.useRouter}}),n.o(t,"useSearchParams")&&n.d(a,{useSearchParams:function(){return t.useSearchParams}})},54325:(e,a,n)=>{"use strict";n.r(a),n.d(a,{default:()=>o});var t=n(95155),s=n(12115),i=n(35695),r=n(25731),l=n(73505),c=n.n(l);function o(){let e=(0,i.useParams)(),a=(0,i.useRouter)(),{user:n}=(0,r.A)(),[l,o]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0),[g,m]=(0,s.useState)(""),[h,_]=(0,s.useState)(null),[x,p]=(0,s.useState)(!1),f=e.gigId,j=e.userId;(0,s.useEffect)(()=>{(async()=>{if(n)try{let e=await fetch("/api/gigs/".concat(f));e.ok?await e.json():console.error("Failed to fetch gig")}catch(e){console.error("Error fetching gig:",e)}finally{u(!1)}})()},[f,n]);let v=async()=>{if(l&&n&&g.trim()){p(!0);try{let e={gigId:l.id,changes:g.trim(),requestedBy:"worker",requestedAt:new Date().toISOString()};(await fetch("/api/gigs/amend-request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok?a.push("/user/".concat(j,"/worker/gigs/").concat(f,"/amend/confirmation")):console.error("Failed to submit amendment request")}catch(e){console.error("Error submitting amendment request:",e)}finally{p(!1)}}},N=async()=>{if(l&&n&&window.confirm("Are you sure you want to cancel this gig? This might incur charges or penalties."))try{(await fetch("/api/gigs/".concat(f,"/cancel"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cancelledBy:"worker",reason:"Worker requested cancellation"})})).ok?a.push("/user/".concat(j,"/worker/gigs")):console.error("Failed to cancel gig")}catch(e){console.error("Error cancelling gig:",e)}};if(d)return(0,t.jsx)("div",{className:c().container,children:(0,t.jsx)("div",{className:c().loading,children:"Loading..."})});if(!l)return(0,t.jsx)("div",{className:c().container,children:(0,t.jsx)("div",{className:c().error,children:"Gig not found"})});let w=(e=>{let a=e.match(/(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})/);if(a){let e=parseInt(a[1]);return Math.max(parseInt(a[3])-e,1)}return 4})(l.gigTime),y=(l.hourlyRate*w).toFixed(2);return(0,t.jsxs)("div",{className:c().container,children:[(0,t.jsx)("div",{className:c().header,children:(0,t.jsx)("h1",{children:"Cancel or Amend Gig Details"})}),(0,t.jsxs)("div",{className:c().changesSection,children:[(0,t.jsx)("div",{className:c().aiIcon,children:"\uD83E\uDD16"}),(0,t.jsx)("p",{children:"What changes would you like to make to the gig? Tell me or edit using the icon below"}),(0,t.jsx)("textarea",{className:c().changesInput,placeholder:"e.g., Add one more hour to the gig or pay \xa322ph",value:g,onChange:e=>m(e.target.value),rows:4})]}),(0,t.jsxs)("div",{className:c().updatedDetailsSection,children:[(0,t.jsxs)("div",{className:c().sectionHeader,children:[(0,t.jsx)("h3",{children:"Updated gig details:"}),(0,t.jsx)("span",{className:c().editIcon,children:"✏️"})]}),(0,t.jsxs)("div",{className:c().detailsGrid,children:[(0,t.jsxs)("div",{className:c().detailRow,children:[(0,t.jsx)("span",{className:c().label,children:"Location:"}),(0,t.jsx)("span",{className:c().value,children:l.location})]}),(0,t.jsxs)("div",{className:c().detailRow,children:[(0,t.jsx)("span",{className:c().label,children:"Date:"}),(0,t.jsx)("span",{className:c().value,children:new Date(l.gigDate).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),(0,t.jsxs)("div",{className:c().detailRow,children:[(0,t.jsx)("span",{className:c().label,children:"Time:"}),(0,t.jsx)("span",{className:c().value,children:(e=>{let a=e.match(/(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})/);if(a){let e=parseInt(a[1]),n=a[2],t=parseInt(a[3]),s=a[4];return"".concat(e>12?e-12:0===e?12:e,":").concat(n," ").concat(e>=12?"PM":"AM"," - ").concat(t>12?t-12:0===t?12:t,":").concat(s," ").concat(t>=12?"PM":"AM")}return e})(l.gigTime)})]}),(0,t.jsxs)("div",{className:c().detailRow,children:[(0,t.jsx)("span",{className:c().label,children:"Pay per hour:"}),(0,t.jsxs)("span",{className:c().value,children:["\xa3",l.hourlyRate]})]}),(0,t.jsxs)("div",{className:c().detailRow,children:[(0,t.jsx)("span",{className:c().label,children:"Total Pay:"}),(0,t.jsxs)("span",{className:c().value,children:["\xa3",y]})]})]}),g.trim()&&(0,t.jsx)("div",{className:c().changesSummary,children:(0,t.jsxs)("p",{children:["Add one more hour. Total gig value is now \xa3",(l.hourlyRate*(w+1)).toFixed(2),", with Able and payment provider fees of \xa3",(l.hourlyRate*(w+1)*.1).toFixed(2),"."]})})]}),(0,t.jsxs)("div",{className:c().actionButtons,children:[(0,t.jsx)("button",{className:c().submitButton,onClick:v,disabled:x||!g.trim(),children:x?"Submitting...":"Submit for Confirmation"}),(0,t.jsxs)("button",{className:c().cancelButton,onClick:N,children:["Cancel gig",(0,t.jsx)("span",{className:c().cancelWarning,children:"(this might incur charges or penalties)"})]})]})]})}},67770:(e,a,n)=>{Promise.resolve().then(n.bind(n,54325))},73505:e=>{e.exports={container:"AmendGigPage_container__E0FNx",header:"AmendGigPage_header__0H0gN",changesSection:"AmendGigPage_changesSection__6Tv20",aiIcon:"AmendGigPage_aiIcon__A_5qu",changesInput:"AmendGigPage_changesInput__B0Q5F",updatedDetailsSection:"AmendGigPage_updatedDetailsSection___AW_Q",sectionHeader:"AmendGigPage_sectionHeader__LvTKb",editIcon:"AmendGigPage_editIcon__L6VFx",detailsGrid:"AmendGigPage_detailsGrid__2kV_h",detailRow:"AmendGigPage_detailRow__Z6gG1",label:"AmendGigPage_label__QKnUL",value:"AmendGigPage_value__aw3c7",changesSummary:"AmendGigPage_changesSummary__aMa2s",actionButtons:"AmendGigPage_actionButtons__nhyk5",submitButton:"AmendGigPage_submitButton__tzmBq",cancelButton:"AmendGigPage_cancelButton__3c7ow",cancelWarning:"AmendGigPage_cancelWarning__y3ll9",loading:"AmendGigPage_loading__8l_Nd",error:"AmendGigPage_error__Gy4sz"}},85004:(e,a,n)=>{"use strict";n.d(a,{D:()=>m,R:()=>g});var t=n(95155),s=n(12115),i=n(23915),r=n(16203),l=n(35317),c=n(90858),o=n(74826),d=n(20996);let u=(0,s.createContext)(null),g=e=>{let{children:a}=e,[n,g]=s.useState(null),[m,h]=s.useState(null),[_,x]=s.useState(null),[p,f]=s.useState(null),[j,v]=s.useState(null),[N,w]=s.useState(!0);return(0,s.useEffect)(()=>{!async function(){let e,a=await fetch("/firebase-config.json"),n=await a.json();0===(0,i.Dk)().length?(console.log("[Firebase] Initializing new instance..."),e=(0,i.Wp)(n)):(console.log("[Firebase] Reusing existing instance."),e=(0,i.Sx)()),g((0,r.xI)(e)),x((0,l.aU)(e)),f((0,c.c7)(e)),v((0,o.lS)(e,{backend:new o.C8})),h((0,d.dG)(e)),w(!1)}()},[]),(0,t.jsx)(u.Provider,{value:{authClient:n,db:_,storage:p,ai:j,messaging:m,loading:N},children:a})},m=()=>{let e=(0,s.useContext)(u);if(!e)throw Error("useFirebase must be used within FirebaseProvider");return e}}},e=>{var a=a=>e(e.s=a);e.O(0,[8822,2992,5965,94,8441,1684,7358],()=>a(67770)),_N_E=e.O()}]);